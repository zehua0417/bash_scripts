#!/bin/bash

# magget: ä¸€ä¸ªå°è£… aria2c çš„ç£åŠ›é“¾æ¥ä¸‹è½½å™¨ï¼Œè‡ªåŠ¨èµ°ä»£ç† + æ·»åŠ  tracker + æ—¥å¿— + ä¼˜é›…è¾“å‡º

# ===================== âš™ï¸ é…ç½®éƒ¨åˆ† =====================
# ä¸‹è½½ä¿å­˜ç›®å½•ï¼ˆå¯ä¿®æ”¹ï¼‰
DOWNLOAD_DIR="$HOME/Downloads/magget"
# HTTP/HTTPS ä»£ç†åœ°å€ï¼ˆç”¨äºæ›¿ä»£ all-proxyï¼Œå› ä¸º aria2 ä¸æ”¯æŒ socks5h:// çš„ all-proxyï¼‰
HTTP_PROXY="http://127.0.0.1:7890"
# é»˜è®¤ tracker åˆ—è¡¨ï¼ˆå¯è‡ªå®šä¹‰ï¼‰
TRACKERS=$(cat <<EOF
udp://tracker.opentrackr.org:1337/announce, udp://open.demonii.com:1337/announce, udp://tracker.torrent.eu.org:451/announce, udp://open.stealth.si:80/announce, udp://explodie.org:6969/announce, udp://exodus.desync.com:6969/announce, udp://tracker-udp.gbitt.info:80/announce, udp://open.free-tracker.ga:6969/announce, http://tracker810.xyz:11450/announce, udp://wepzone.net:6969/announce, udp://tracker.tiny-vps.com:6969/announce, udp://tracker.srv00.com:6969/announce, udp://tracker.qu.ax:6969/announce, udp://tracker.filemail.com:6969/announce, udp://tracker.edkj.club:6969/announce, udp://tracker.dump.cl:6969/announce, udp://tracker.dler.org:6969/announce, udp://tracker.bittor.pw:1337/announce, udp://tracker.0x7c0.com:6969/announce, udp://retracker01-msk-virt.corbina.net:80/announce
EOF
)
# æ—¥å¿—æ–‡ä»¶
LOG_FILE="$HOME/.magget.log"

# ===================== ğŸ§  å‡½æ•°å®šä¹‰ =====================
print_usage() {
  echo -e "\n\033[1;34mUsage:\033[0m"
  echo "  magget <magnet_link>"
  echo -e "\nExample:"
  echo "  magget 'magnet:?xt=urn:btih:xxxx...'"
}

# ===================== ğŸš€ å¯åŠ¨ä¸‹è½½ =====================
main() {
  if [[ -z "$1" ]]; then
    print_usage
    exit 1
  fi

  MAGNET_LINK="$1"
  mkdir -p "$DOWNLOAD_DIR"
  echo -e "\n\033[1;32m[magget] å¼€å§‹ä¸‹è½½ï¼š\033[0m$MAGNET_LINK"
  echo "[magget] ä¸‹è½½ç›®å½•ï¼š$DOWNLOAD_DIR"

  aria2c \
    --dir="$DOWNLOAD_DIR" \
    --enable-dht=true \
    --max-connection-per-server=16 \
    --split=64 \
    --min-split-size=1M \
    --bt-enable-lpd=true \
    --bt-tracker="$TRACKERS" \
    --http-proxy="$HTTP_PROXY" \
    --https-proxy="$HTTP_PROXY" \
    --summary-interval=5 \
    --console-log-level=notice \
    --user-agent="magget/1.0" \
    --file-allocation=none \
    "$MAGNET_LINK" | tee -a "$LOG_FILE"
}

main "$1"
